import json

# 我们期望的标准结构
_STANDARD_SECTIONS = [
    "研究背景", "研究方法", "实验设计", "结果与分析", "总体结论"
]

MAPPING_SECTIONS_PROMPT = f"""
你是一位顶级的科研助理，擅长快速分析计算机科学领域的学术论文结构。

你的任务是将一篇论文的目录结构，映射到我们预设的几个标准分析模块上。

**论文标题:** {{paper_title}}

**论文摘要:**
{{abstract}}

**论文目录结构:**
```
{{toc_string}}
```

**标准分析模块:**
{json.dumps(_STANDARD_SECTIONS, indent=2, ensure_ascii=False)}

**你的任务:**
请仔细阅读摘要和目录，然后为目录中的 **每一个章节标题** 判断它分别属于哪个"标准分析模块"。

**输出要求:**
1.  你的输出必须是 **严格的JSON格式**，不包含任何JSON以外的解释或文字。
2.  JSON的键（key）必须是上面定义的"标准分析模块"。
3.  JSON的值（value）是一个列表，其中包含所有被归类到该模块的、来自 **原始论文目录** 的章节标题（字符串）。
4.  一个章节标题只能被分配到一个模块。如果某个章节（如 "References"）不属于任何模块，请直接忽略它。
5.  "Introduction", "Related Work" 等通常属于 "研究背景"。
6.  "Method", "Model", "Approach", "Architecture" 等通常属于 "研究方法"。
7.  "Experiments", "Evaluation", "Setup" 等通常属于 "实验设计"。
8.  "Results", "Analysis", "Ablation Study" 等通常属于 "结果与分析"。
9.  "Conclusion", "Future Work" 等通常属于 "总体结论"。
"""

SUMMARIZE_SECTION_PROMPT = """
你是一个专门分析学术论文的AI助手。
你的任务是根据用户提供的特定章节的原文，以及该章节相关的图表分析，生成一份详细、清晰、结构化的章节摘要。

**你的目标:**
1.  **核心内容提炼:** 精准概括本章节的核心论点、主要发现或关键方法。
2.  **逻辑梳理:** 清晰地呈现内容之间的逻辑关系，例如因果、递进、对比等。
3.  **结合图表:** 如果提供了图表分析，需要将图表信息有机地融入摘要中，解释图表如何支撑章节的论点。

**章节名称:**
{section_name}

**相关图表分析:**
{figures_analysis}

**章节原文:**
{section_content}

**输出要求:**
请以 Markdown 格式返回你的摘要，确保内容准确、语言流畅。
"""

ANALYZE_FIGURE_PROMPT = """
你是一个专门分析学术论文图表的AI助手。
你的任务是根据用户提供的图表图片和对应的图注/表注，生成一份对该图表的详细解读。

**你的目标:**
1.  **描述图表内容 (What):** 清晰地描述图表是什么类型（如折线图、柱状图、流程图、模型架构图等），以及它展示了哪些数据和元素。
2.  **解释图表目的 (Why):** 分析作者展示这个图表的意图是什么？它试图说明什么问题或证明什么观点？
3.  **总结图表结论 (Conclusion):** 从图表中可以得出什么核心结论或重要发现？

**图注/表注:**
{figure_caption}

**输出要求:**
请返回一段通顺的文本，全面地解读这个图表。
"""

GENERATE_FINAL_INSIGHTS_PROMPT = """
你是一个顶尖的科研领域AI评审员。
你的任务是在阅读了一篇论文的所有章节摘要和图表分析后，从一个批判性和全局性的视角，对该论文进行深入的分析。

**你的目标:**
1.  **优点与创新 (Strengths and Innovations):** 识别并总结这篇论文最主要的贡献、创新点和做得好的地方。
2.  **不足与反思 (Weaknesses and Reflections):** 提出论文中存在的潜在问题、研究的局限性、实验设计的不足，或者你认为可以进一步改进的地方。
3.  **提出深刻问题 (Insightful Questions):** 提出3个与论文核心内容相关的、有深度、能启发思考的问题，并给出你自己的简要回答或分析方向。

**输入材料:**
你已经掌握了以下信息：
- 论文所有章节的摘要。
- 论文所有图表的分析。
- 论文引言（Introduction）部分的原文。
- 论文结论（Conclusion）部分的原文。

**所有章节摘要:**
```json
{all_summaries}
```

**所有图表分析:**
```
{all_figures_analysis}
```

**引言原文:**
```
{introduction_text}
```

**结论原文:**
```
{conclusion_text}
```

**输出要求:**
请严格按照以下 Markdown 格式返回你的分析报告:

### 1. 优点与创新
- [优点1]
- [优点2]
- ...

### 2. 不足与反思
- [不足1]
- [不足2]
- ...

### 3. 三个核心问题与回答
**问题1:** [你提出的问题]
**回答:** [你的分析和回答]

**问题2:** [你提出的问题]
**回答:** [你的分析和回答]

**问题3:** [你提出的问题]
**回答:** [你的分析和回答]
"""

# 用于第一步：动态、智能地生成章节分析框架
SMART_ANALYZE_SECTION_PROMPT = """
你是一位顶级的科研助理，拥有极强的论文阅读、信息提炼和结构化总结能力。
你的任务是仔细阅读一篇学术论文的特定章节内容，并为该章节提炼出最核心、最关键的分析要点。

**待分析章节名称:** {section_name}

**相关图表分析结论:**
```
{related_figures_analysis}
```

**章节全部原文:**
```
{section_content}
```
---
**任务要求:**

1.  请完整阅读并理解上述所有内容。
2.  请从**原文**中提炼出3-4个最能概括本章节核心思想的分析要点（Key Points）。
3.  要点必须与原文内容紧密相关，切中要害，避免空泛、通用的描述。
4.  **要点应为简短精炼的短语，用于清晰概括一个核心主题（例如："数据量对能力的影响","不同数据组合对性能的影响","实验设置","实验步骤"等），而不是完整的句子。**
5.  请以JSON格式返回你为本章节量身定制的分析要点列表。

**请严格按照以下JSON格式输出结果，不要有任何其他多余的文字：**
```json
{{
    "analysis_points": [
        "要点1",
        "要点2",
        "要点3"
    ]
}}
```
"""

# 用于第二步：根据指定框架和原文，进行深入分析
DEEP_ANALYZE_PROMPT = """
你是一位顶级的科研助理，现在需要进行深入分析。
你已经为某个章节定义了分析要点，现在请根据这些要点，从章节原文中提取详细内容。

**待分析部分:** {section_name}

**你之前生成的分析要点:**
{analysis_points_str}

**相关图表分析:**
```
{related_figures_analysis}
```

**"{section_name}" 部分的全部原文:**
```
{section_content}
```

**你的任务与输出要求:**
1.  **仔细阅读** 上述提供的所有原文。
2.  **针对你之前生成的每一个"分析要点"**，从原文中提炼出最相关、最核心的内容。
3.  你的输出必须是 **严格的JSON格式**，不包含任何JSON以外的解释或文字。
4.  JSON的键（key）是 **"analysis_details"**。
5.  该键的值（value）是另一个JSON对象，其键是 **"分析要点"** 列表中的每一项，值（value）是根据原文内容提炼出的 **详细文本（字符串）**。

**示例输出格式:**
```json
{{
    "analysis_details": {{
        "要点1": "从原文中提炼出的关于分析要点1的详细内容...",
        "要点2": "从原文中提炼出的关于分析要点2的详细内容...",
        "要点3": "从原文中提炼出的关于分析要点3的详细内容..."
    }}
}}
```
""" 